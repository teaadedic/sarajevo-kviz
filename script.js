
const quizData = {"questions": [{"question": "Šta ćeš reći kad naručujes pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}, {"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}], "variants": [[{"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}], [{"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}, {"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}], [{"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}, {"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}], [{"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}, {"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}], [{"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}, {"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}], [{"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}, {"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}], [{"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}, {"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}], [{"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}, {"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}], [{"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}, {"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}], [{"question": "Šta je ispravno reći ako želiš da preživiš u buregdžinici i naručiš pitu sa sirom?", "options": ["Burek sa sirom", "Sirnica", "Burek", "Sirni burek"], "correct": 1}, {"question": "Koji sarajevski simbol ima više slika na Instagramu nego Eiffelov toranj?", "options": ["Sebilj", "Vijećnica", "Žuta tabija", "Mrtva trka sa ćevapima"], "correct": 0}, {"question": "Šta je najgora greška koju možeš napraviti na Baščaršiji?", "options": ["Tražiti kečap uz ćevape", "Ne hraniti golubove", "Reći da si iz Zagreba", "Pokušati platiti karticom"], "correct": 0}]]};

let currentQuestionIndex = 0;
let currentQuiz = [];

function renderButtons(variants) {
  const buttonsDiv = document.getElementById("buttons");
  buttonsDiv.innerHTML = "";
  variants.forEach((quiz, index) => {
    const btn = document.createElement("button");
    btn.textContent = `Kviz ${index + 1}`;
    btn.onclick = () => {
      document.getElementById('quiz-selector').classList.add('hidden');
      document.getElementById('quiz-tab').classList.remove('hidden');
      document.getElementById('quiz-title').textContent = btn.textContent;
      currentQuestionIndex = 0;
      currentQuiz = quiz.map(q => Object.assign({}, q));
      showQuestion();
    };
    buttonsDiv.appendChild(btn);
  });
}

function showQuestion() {
  const quizDiv = document.getElementById("quiz");
  const resultDiv = document.getElementById("result");
  quizDiv.innerHTML = "";
  resultDiv.classList.add("hidden");

  const q = currentQuiz[currentQuestionIndex];
  const qDiv = document.createElement("div");
  qDiv.className = "question";
  qDiv.innerHTML = `<p>${q.question}</p>`;

  // Feedback message placeholder
  const feedback = document.createElement("div");
  feedback.id = "feedback-message";
  feedback.style.color = "red";
  feedback.style.fontWeight = "bold";
  feedback.style.marginTop = "10px";

  q.options.forEach((opt, j) => {
    const label = document.createElement("label");
    label.className = "option-card";
    label.innerHTML = `<input type="radio" name="q" value="${j}" /> ${String.fromCharCode(65 + j)}. ${opt}`;
    label.onclick = () => {
      document.querySelectorAll(".option-card").forEach(el => el.classList.remove("selected"));
      label.classList.add("selected");
      feedback.textContent = ""; // Clear feedback when new option selected
    };
    qDiv.appendChild(label);
    qDiv.appendChild(document.createElement("br"));
  });

  qDiv.appendChild(feedback); // Add feedback div here

  const nextBtn = document.createElement("button");
  nextBtn.textContent = currentQuestionIndex < currentQuiz.length - 1 ? "Dalje" : "Završi";
  nextBtn.onclick = () => {
    const selected = document.querySelector('input[name="q"]:checked');
    if (!selected) {
      feedback.textContent = "Odaberi odgovor!";
      return;
    }
    const answer = parseInt(selected.value);
    currentQuiz[currentQuestionIndex].userAnswer = answer;

    if (answer === q.correct) {
      launchConfetti();
      currentQuestionIndex++;
      if (currentQuestionIndex < currentQuiz.length) {
        showQuestion();
      } else {
        showResult();
      }
    } else {
      feedback.textContent = "Netačan odgovor! Pokušaj ponovo.";
    }
  };

  quizDiv.appendChild(qDiv);
  quizDiv.appendChild(nextBtn);
}


function showResult() {
  const quizDiv = document.getElementById("quiz");
  const resultDiv = document.getElementById("result");
  quizDiv.innerHTML = "";
  let correctCount = 0;
  currentQuiz.forEach(q => {
    if (q.userAnswer === q.correct) correctCount++;
  });
  resultDiv.textContent = `Tačnih odgovora: ${correctCount} od ${currentQuiz.length}`;
  resultDiv.classList.remove("hidden");
}

function launchConfetti() {
  const duration = 1 * 1000;
  const animationEnd = Date.now() + duration;
  const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };

  function randomInRange(min, max) {
    return Math.random() * (max - min) + min;
  }

  const interval = setInterval(function() {
    const timeLeft = animationEnd - Date.now();

    if (timeLeft <= 0) {
      return clearInterval(interval);
    }

    const particleCount = 30 * (timeLeft / duration);
    confetti(Object.assign({}, defaults, {
      particleCount,
      origin: {
        x: randomInRange(0.2, 0.8),
        y: Math.random() - 0.2
      }
    }));
  }, 250);
}

document.getElementById("back-btn").onclick = () => {
  document.getElementById("quiz-tab").classList.add("hidden");
  document.getElementById("quiz-selector").classList.remove("hidden");
};

renderButtons(quizData.variants);
